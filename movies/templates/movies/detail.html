{% extends 'base.html' %}
{% load bootstrap4 %}

{% block content %}
<h1>{{ movie.title }} 페이지</h1>
<div class="card mb-3">
  
  <!-- youtube -->
  {% if videoid %}
  <div class="embed-responsive embed-responsive-16by9">
    <iframe type="text/html" class="embed-responsive-item" src="https://www.youtube.com/embed/{{ videoid }}" frameborder="0"></iframe>
  </div>
  {% else %}
  <img src="https://image.tmdb.org/t/p/w500/{{ movie.backdrop_path }}" class="card-img-top" alt="영화 배경 포스터">
  {% endif %}


  <div class="card-body">
    <h5 class="card-title">movie title : {{ movie.original_title }}</h5>
    <p class="card-text">{{ movie.overview }}</p>
    <p>영화 인기도 : {{ movie.popularity }}</p>
    <p>영화 개봉일 : {{ movie.release_date }}</p>
    <p>영화 평점 : {{ movie.vote_average }}</p>
    <p>영화 언어 : {{ movie.original_language }}</p>
    <p>영화 장르 :
      {% for genre in movie.genres.all %}
      <!-- 장르 이름 안뜬다!! 에러 고치기 -->
        {{ genre.name }}
      {% endfor %}
    </p>
    {% if user in movie.like_users.all %}
    <i class="fas fa-heart fa-lg like-button" style="color: crimson;" data-id="{{ movie.pk }}"></i>
    {% else %}
    <i class="fas fa-heart fa-lg like-button" style="color: black;" data-id="{{ movie.pk }}"></i>
    {% endif %}
    <span id="like-count-{{ movie.pk }}">{{ movie.like_users.all|length }}</span>명이 이 글을 좋아합니다.
    <a class="btn btn-primary" href="{% url 'movies:index' %}" class="btn btn-primary">영화 목록 보러가기</a>
  </div>
</div>


<script>
  // 좋아요 기능
const likeButtonList = document.querySelectorAll('.like-button')
likeButtonList.forEach(likeButton => {
  likeButton.addEventListener('click', function (event) {
    const movieId = event.target.dataset.id
    {% if request.user.is_authenticated %}
      axios.get(`/movies/${movieId}/like/`)
        .then(response => {
        document.querySelector(`#like-count-${movieId}`).innerText = response.data.count
        if (response.data.liked) {
          event.target.style.color = 'crimson'
        } else {
          event.target.style.color = 'black'
        }
      })
        .catch(error => { console.log(error) })
    {% else %}
      alert('비로그인 사용자는 누를 수 없습니다.')
    {% endif %}
 })
})


</script>


{% endblock %}